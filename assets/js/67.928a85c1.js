(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{376:function(v,_,t){"use strict";t.r(_);var a=t(42),s=Object(a.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"_01-v8-是如何执行一段-js-代码的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-v8-是如何执行一段-js-代码的"}},[v._v("#")]),v._v(" 01 | V8 是如何执行一段 JS 代码的")]),v._v(" "),t("p",[v._v("V8 是由 Google 开发的开源 JavaScript 引擎，也被称为虚拟机，模拟实际计算机各种功能来实现代码的编译和执行。那么，要想搞清楚 V8 内部的工作流程和原理，我们可以从分析计算机对语言的编译和执行过程入手。")]),v._v(" "),t("h2",{attrs:{id:"一、v8-执行代码的流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、v8-执行代码的流程"}},[v._v("#")]),v._v(" 一、V8 执行代码的流程")]),v._v(" "),t("p",[v._v("V8 执行 JS 代码的核心流程主要分为两步："),t("strong",[v._v("编译")]),v._v(" 和 "),t("strong",[v._v("执行")]),v._v("。首先需要将 JS 代码转化成低级中间代码或者机器能够理解的机器代码，然后再执行输出结果。")]),v._v(" "),t("h2",{attrs:{id:"二、为什么要高级语言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、为什么要高级语言"}},[v._v("#")]),v._v(" 二、为什么要高级语言")]),v._v(" "),t("p",[v._v("CPU 看成是一个非常小的运算机器，我们通过"),t("strong",[v._v("二进制的指令")]),v._v("和 CPU 进行沟通。工程师们为 CPU 提供了一大堆指令，这一大堆指令称为"),t("strong",[v._v("指令集")]),v._v("，也就是"),t("strong",[v._v("机器语言")]),v._v("。\n"),t("br"),v._v("但是二进制难以阅读和记忆，则将二进制指令集转换为人类可以识别和记忆的符号，这就是"),t("strong",[v._v("汇编指令集")]),v._v("。不同的 CPU 有着不同的指令集，如：intel，ARM，MIP5等。\n所以在编写汇编代码时，我们还需要了解和处理器架构相关的硬件知识。")]),v._v(" "),t("p",[v._v("所以就生出了如：C、C++、Java、C#、Python、JavaScript 等高级语言。")]),v._v(" "),t("p",[v._v("高级语言和汇编语言一样，处理器也不能直接识别由其所编写的代码，所以执行的方式有两种："),t("strong",[v._v("解释执行")]),v._v("和"),t("strong",[v._v("编译执行")]),v._v("。")]),v._v(" "),t("ul",[t("li",[v._v("解释执行（源代码 ==> 解析器 ==> 中间代码 ==> 解释器 ==> 结果）"),t("strong",[v._v("启动快，执行慢")]),v._v(" "),t("img",{attrs:{src:"/images/V8-inter.jpg",alt:"解释执行流程图"}})]),v._v(" "),t("li",[v._v("编译执行 (源代码 ==> 解析器 ==> 中间代码 ==> 编译器 ==> 二进制代码 ==> 执行结果)"),t("strong",[v._v("启动慢，执行快")]),v._v(" "),t("img",{attrs:{src:"/images/V8-Complied.jpg",alt:"编译执行流程图"}})])]),v._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[v._v("字节码和机器码的区别")]),v._v(" "),t("p",[v._v("首先明确一点就是字节码不是机器码！！！")]),v._v(" "),t("ul",[t("li",[v._v("字节码是一种中间代码，需要通过解释器才能称为机器码")]),v._v(" "),t("li",[v._v("机器码是可以被CPU执行的二进制码")])])]),v._v(" "),t("h2",{attrs:{id:"三、v8-是怎么执行-js-代码的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、v8-是怎么执行-js-代码的"}},[v._v("#")]),v._v(" 三、V8 是怎么执行 JS 代码的")]),v._v(" "),t("p",[v._v("V8 采用混合编译执行和解释执行这两种手段。"),t("strong",[v._v("我们把这种混合使用编译器和解释器的技术称为 JIT（Just In Time）技术")]),v._v("。\n"),t("img",{attrs:{src:"/images/8a34ae8c1a7a0f87e19b1384a025e354.jpg",alt:"V8执行一段JavaScript流程图"}})]),v._v(" "),t("ul",[t("li",[v._v("V8 会接收到要执行的 JavaScript 源代码，只是一堆字符串，需要结构化这段字符串。")]),v._v(" "),t("li",[v._v("V8 源代码的结构化之后，就生成了"),t("strong",[v._v("抽象语法树 (AST)")]),v._v("。")]),v._v(" "),t("li",[v._v("在生成 AST 的同时，V8 还会生成相关的作用域，作用域中存放相关变量。")]),v._v(" "),t("li",[v._v("接下来就可以生成字节码了，字节码是介于 AST 和机器代码的中间代码。")]),v._v(" "),t("li",[v._v("解释器就登场了，它会按照顺序解释执行字节码，并输出执行结果。")]),v._v(" "),t("li",[v._v("在解释执行字节码的过程中，如果发现了某一段代码会被重复多次执行，那么监控机器人就会将这段代码标记为热点代码。")]),v._v(" "),t("li",[v._v("V8 就会将热点代码丢给优化编译器，优化编译器会在后台将字节码编译为二进制代码，然后进行优化。")]),v._v(" "),t("li",[v._v("如果下面再执行到这段代码时，V8 会优先选择优化之后的二进制代码，这样代码的执行速度就会大幅提升。")])]),v._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[v._v("反优化")]),v._v(" "),t("p",[v._v("JavaScript 是一种非常灵活的动态语言，对象的结构和属性是可以在运行时任意修改的。")]),v._v(" "),t("p",[v._v("而经过优化编译器优化过的代码只能针对某种固定的结构，一旦在执行过程中，对象的结构被动态修改了，那么优化之后的代码势必会变成无效的代码。")]),v._v(" "),t("p",[v._v("这时候优化编译器就需要执行反优化操作，经过反优化的代码，下次执行时就会回退到解释器解释执行。")])]),v._v(" "),t("h2",{attrs:{id:"四、总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、总结"}},[v._v("#")]),v._v(" 四、总结")]),v._v(" "),t("p",[v._v("V8 执行一段 JavaScript 代码所经历的主要流程：")]),v._v(" "),t("ul",[t("li",[v._v("初始化基础环境")]),v._v(" "),t("li",[v._v("解析源码生成 AST 和作用域")]),v._v(" "),t("li",[v._v("依据 AST 和作用域生成字节码")]),v._v(" "),t("li",[v._v("解释执行字节码")]),v._v(" "),t("li",[v._v("监听热点代码")]),v._v(" "),t("li",[v._v("优化热点代码为二进制的机器代码")]),v._v(" "),t("li",[v._v("反优化生成的二进制机器代码")])])])}),[],!1,null,null,null);_.default=s.exports}}]);